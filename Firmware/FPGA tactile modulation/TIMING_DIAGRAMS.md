# Timing Diagrams - FPGA Tactile Modulation

## 1. Counter and Bit Extraction

### 7-bit Counter (0-127)
```
Time (ns):    0    20   40   60   80  100  120  140  160  180  200  220  240  260
             ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────
counter[6:0] │ 0  │ 1  │ 2  │ 3  │ 4  │ 5  │ 6  │ 7  │ 8  │ 9  │ 10 │ 11 │ 12 │ 13
             └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────
```

### Extracted Bits for Phase Matching
```
Time (ns):    0    20   40   60   80  100  120  140  160  180  200  220  240  260
             ┌─────────────────────────────┬─────────────────────────────┬──────────
counter[6:3] │             0               │             1               │    2
             └─────────────────────────────┴─────────────────────────────┴──────────
             
             ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────
counter[2:0] │ 0  │ 1  │ 2  │ 3  │ 4  │ 5  │ 6  │ 7  │ 0  │ 1  │ 2  │ 3  │ 4  │ 5
             └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────
```

**Key Points:**
- `counter[6:3]` changes every 8 clock cycles (160 ns)
- `counter[2:0]` changes every clock cycle (20 ns)
- `counter[6:3]` is used for phase matching (0-15)
- `counter[2:0]` is used for multiplexing (0-7)

---

## 2. Phase Matching and Pulse Generation

### Example: Phase = 10

```
Time (μs):    0.0   0.16  0.32  0.48  0.64  0.80  0.96  1.12  1.28  1.44  1.60  1.76  1.92  2.08  2.24  2.40
             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
counter[6:3] │  0   │  1   │  2   │  3   │  4   │  5   │  6   │  7   │  8   │  9   │  10  │  11  │  12  │  13  │  14  │  15
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────
                                                                                              ▲
                                                                                         PHASE MATCH!
             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
s_counter    │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  7   │  6   │  5   │  4   │  3   │  2
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────
                                                                                              └─────────────────────────────────►
                                                                                                   Countdown 7→0
             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────────────────────────────────┬──────
pulse        │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │              1                     │  0
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴────────────────────────────────────┴──────
                                                                                              └────────── 160 ns ──────────┘
```

**Key Points:**
- When `counter[6:3]` matches `s_phaseCurrent`, set `s_counter = 7`
- `s_counter` counts down: 7→6→5→4→3→2→1→0
- Pulse is HIGH while `s_counter > 0` (8 clock cycles = 160 ns)
- Pulse repeats every 16 counter steps (2.56 μs)

---

## 3. Multiple Emitters with Different Phases

### Three Emitters: Phase 0, 5, 10

```
Time (μs):    0.0   0.16  0.32  0.48  0.64  0.80  0.96  1.12  1.28  1.44  1.60  1.76  1.92  2.08  2.24  2.40
             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
counter[6:3] │  0   │  1   │  2   │  3   │  4   │  5   │  6   │  7   │  8   │  9   │  10  │  11  │  12  │  13  │  14  │  15
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────
                      ▲                             ▲                                         ▲
                   Phase 0                       Phase 5                                  Phase 10

             ┌────────────────────────────────────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
Emitter 0    │              1                     │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0
             └────────────────────────────────────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────

             ┌──────┬──────┬──────┬──────┬──────┬────────────────────────────────────┬──────┬──────┬──────┬──────┬──────┬──────
Emitter 1    │  0   │  0   │  0   │  0   │  0   │              1                     │  0   │  0   │  0   │  0   │  0   │  0
             └──────┴──────┴──────┴──────┴──────┴────────────────────────────────────┴──────┴──────┴──────┴──────┴──────┴──────

             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬────────────────────────────────────┬──────
Emitter 2    │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │  0   │              1                     │  0
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴────────────────────────────────────┴──────
```

**Key Points:**
- Each emitter pulses at a different time
- Time offset = phase difference × 160 ns
- Emitter 0 to Emitter 1: 5 steps = 800 ns delay
- Emitter 1 to Emitter 2: 5 steps = 800 ns delay
- These time offsets create spatial phase differences at 40 kHz

---

## 4. Time Division Multiplexing (Mux8)

### 8 Emitters Sharing One Output Pin

```
Time (ns):    0    20   40   60   80  100  120  140  160  180  200  220  240  260
             ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────
counter[2:0] │ 0  │ 1  │ 2  │ 3  │ 4  │ 5  │ 6  │ 7  │ 0  │ 1  │ 2  │ 3  │ 4  │ 5
             └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────
                  │    │    │    │    │    │    │    │    │    │    │    │    │
                  ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼    ▼
             ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────
Emitter 0    │ 1  │    │    │    │    │    │    │    │ 1  │    │    │    │    │
Emitter 1    │    │ 0  │    │    │    │    │    │    │    │ 0  │    │    │    │
Emitter 2    │    │    │ 1  │    │    │    │    │    │    │    │ 1  │    │    │
Emitter 3    │    │    │    │ 0  │    │    │    │    │    │    │    │ 0  │    │
Emitter 4    │    │    │    │    │ 1  │    │    │    │    │    │    │    │ 1  │
Emitter 5    │    │    │    │    │    │ 0  │    │    │    │    │    │    │    │
Emitter 6    │    │    │    │    │    │    │ 1  │    │    │    │    │    │    │
Emitter 7    │    │    │    │    │    │    │    │ 0  │    │    │    │    │    │
             └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────
                  ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓    ↓
             ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────
Output Pin   │ 1  │ 0  │ 1  │ 0  │ 1  │ 0  │ 1  │ 0  │ 1  │ 0  │ 1  │ 0  │ 1  │ 0
             └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────
```

**Key Points:**
- Each emitter gets 1/8 of the time (one 20 ns slot per 160 ns)
- `counter[2:0]` selects which emitter appears on output
- Output pin shows rapid switching between 8 emitters
- Transducer averages these pulses due to mechanical inertia

---

## 5. Amplitude Modulation Timing

### chgClock Generation (step = 10)

```
Time (μs):    0.0   0.2   0.4   0.6   0.8   1.0   1.2   1.4   1.6   1.8   2.0
             ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────
s_stepCounter│  0  │  1  │  2  │  3  │  4  │  5  │  6  │  7  │  8  │  9  │  10
             └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────
                                                                              ▲
                                                                         Match 'steps'
             ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬──┬──
chgClock     │  0  │  0  │  0  │  0  │  0  │  0  │  0  │  0  │  0  │  0  │ 1│ 0
             └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴──┴──
                                                                              └─► Pulse
```

### s_enabled Toggle (All 256 Emitters)

```
Time (μs):    0     51    102   153   204   255   306   357   408   459   510
             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
chgClock     ──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌──┐  ┌─
               └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘  └──┘
                  ▲     ▲     ▲     ▲     ▲     ▲     ▲     ▲     ▲     ▲     ▲
             ┌────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴────
s_enabled[i] │    1     │    0     │    1     │    0     │    1     │    0     │
             └──────────┴──────────┴──────────┴──────────┴──────────┴──────────┴────
                  ON        OFF        ON        OFF        ON        OFF
```

**Key Points:**
- `chgClock` pulses every (steps × 20 ns) = 200 ns for step=10
- After 256 pulses, one complete modulation cycle = 51.2 μs
- All 256 emitters toggle synchronously
- Creates pulsating focal point at 19.5 kHz (for step=10)

---

## 6. Complete System Timing (One Emitter)

```
Time (μs):    0.0   0.5   1.0   1.5   2.0   2.5   3.0   3.5   4.0   4.5   5.0
             ┌─────────────────────────────────────────────────────────────────
System Clock ─┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐┌┐
              └┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘└┘
             50 MHz (20 ns period)

             ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────
counter[6:3] │  0   │  1   │  2   │  3   │  4   │  5   │  6   │  7   │  8   │  9
             └──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────
             160 ns per step

             ┌──────┬──────┬──────┬──────┬──────┬────────────────────────────────────
pulse        │  0   │  0   │  0   │  0   │  0   │              1
             └──────┴──────┴──────┴──────┴──────┴────────────────────────────────────
             Pulse when counter = phase (example: phase = 5)

             ┌────────────────────────────────────┬────────────────────────────────────
s_enabled    │                1                   │                0
             └────────────────────────────────────┴────────────────────────────────────
             Toggles on chgClock (not shown at this timescale)

             ┌──────┬──────┬──────┬──────┬──────┬────────────────────────────────────
output       │  0   │  0   │  0   │  0   │  0   │              1
             └──────┴──────┴──────┴──────┴──────┴────────────────────────────────────
             output = pulse AND s_enabled
```

---

**Version:** 1.0  
**Date:** 2026-01-16  
**Companion Documents:** PHASE_COMMUNICATION_DOCUMENTATION.md, QUICK_REFERENCE.md

